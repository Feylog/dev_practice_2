üêò + üöÄ + üìä

> Docker-based test stand for PostgreSQL, ClickHouse, and Superset. Use this to evaluate query performance and test analytics scenarios.

# Test Stand: PostgreSQL + ClickHouse + Superset

## –°–æ—Å—Ç–∞–≤ —Å—Ç–µ–Ω–¥–∞

- **PostgreSQL** —Å –¥–µ–º–æ-—Ç–∞–±–ª–∏—Ü–µ–π
- **ClickHouse** —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ PostgreSQL —á–µ—Ä–µ–∑ –¥–≤–∏–∂–æ–∫ PostgreSQL
- **Apache Superset** –∫–∞–∫ BI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## –ó–∞–ø—É—Å–∫

```bash
docker-compose up -d
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –≤ Yandex Cloud

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –í–ú

1. –ó–∞–π–¥–∏ –≤ [Yandex Cloud](https://cloud.yandex.ru/) –∏ —Å–æ–∑–¥–∞–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É (–í–ú) –Ω–∞ –±–∞–∑–µ Ubuntu (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ubuntu-22.04`).
2. –£–∫–∞–∂–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
   - 2 vCPU, 4 –ì–ë RAM
   - 20+ –ì–ë SSD
3. –†–∞–∑—Ä–µ—à–∏ –≤—Ö–æ–¥ –ø–æ SSH –∏ –¥–æ–±–∞–≤—å —Å–≤–æ–π –ø—É–±–ª–∏—á–Ω—ã–π SSH-–∫–ª—é—á.

#### üìå –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é IP-–∞–¥—Ä–µ—Å –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –í–ú. –ß—Ç–æ–±—ã —ç—Ç–æ–≥–æ –∏–∑–±–µ–∂–∞—Ç—å:

1. –ü–µ—Ä–µ–π–¥–∏ –≤ [Yandex Cloud ‚Üí VPC ‚Üí Static IP addresses](https://console.cloud.yandex.ru/vpc/addresses)
2. –ù–∞–∂–º–∏ **"–°–æ–∑–¥–∞—Ç—å"** –∏ –≤—ã–±–µ—Ä–∏:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: –Ω–∞–ø—Ä–∏–º–µ—Ä, `superset-ip`
   - –ó–æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏: —Ç–∞–∫–∞—è –∂–µ, –∫–∞–∫ —É –í–ú (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ru-central1-a`)
3. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–∂–º–∏ **"–ü—Ä–∏–≤—è–∑–∞—Ç—å"** –∏ –≤—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—É—é –í–ú

–¢–µ–ø–µ—Ä—å IP-–∞–¥—Ä–µ—Å –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º, –∏ —Ç—ã –≤—Å–µ–≥–¥–∞ —Å–º–æ–∂–µ—à—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ Superset –ø–æ –æ–¥–Ω–æ–º—É –∏ —Ç–æ–º—É –∂–µ –∞–¥—Ä–µ—Å—É.

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh ubuntu@<EXTERNAL_IP>
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose

```bash
sudo apt update
sudo apt install -y docker.io docker-compose
sudo usermod -aG docker $USER
newgrp docker
```

–ü—Ä–æ–≤–µ—Ä—å —É—Å—Ç–∞–Ω–æ–≤–∫—É:

```bash
docker -v
docker-compose -v
```

### 4. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
git clone <URL_–í–ê–®–ï–ì–û_–†–ï–ü–û–ó–ò–¢–û–†–ò–Ø>
cd <–ò–ú–Ø_–ü–ê–ü–ö–ò_–ü–†–û–ï–ö–¢–ê>
```

### 5. –ó–∞–ø—É—Å–∫ —Å—Ç–µ–Ω–¥–∞

```bash
docker-compose up -d
```

### 6. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–æ–≤ PostgreSQL –∏ ClickHouse –¥–ª—è Superset

Superset —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö Python-–±–∏–±–ª–∏–æ—Ç–µ–∫. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π Dockerfile, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç:

- –£—Å—Ç–∞–Ω–æ–≤–∫—É —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: `gcc`, `g++`, `python3-dev`, `libffi-dev`
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é SQLAlchemy (`<2.0.0`), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ —Å `eagerload`
- –î—Ä–∞–π–≤–µ—Ä—ã:
  - `psycopg2-binary` (–¥–ª—è PostgreSQL)
  - `clickhouse-sqlalchemy` (–¥–ª—è ClickHouse)

–ï—Å–ª–∏ –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, Superset –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `docker-compose`.

### 7. –î–æ—Å—Ç—É–ø

- Superset: `http://<EXTERNAL_IP>:8088`
  - –õ–æ–≥–∏–Ω: `admin`
  - –ü–∞—Ä–æ–ª—å: `admin`

# .gitignore

```
# Docker volumes
pg_data/
ch_data/
superset_home/

# Python
__pycache__/
*.pyc

# Editor files
.vscode/
.idea/

# System
.DS_Store
.env
```
